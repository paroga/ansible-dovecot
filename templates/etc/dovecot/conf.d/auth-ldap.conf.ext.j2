# {{ ansible_managed }}
{#

This file follows the upstream default configuration except for the parts
that are configurable via DebOps variables. If you need a more customized
setup, you can provide your own template via lookup mechanism.

#}

{% if dovecot_user_accounts is defined and dovecot_user_accounts %}
{%   if 'ldap' in dovecot_user_accounts %}
# Authentication for LDAP users. Included from 10-auth.conf.
#
# <doc/wiki/AuthDatabase.LDAP.txt>

passdb {
  driver = ldap

  # Path for LDAP configuration file, see example-config/dovecot-ldap.conf.ext
  args = /etc/dovecot/dovecot-ldap.conf.ext
}

# "prefetch" user database means that the passdb already provided the
# needed information and there's no need to do a separate userdb lookup.
# <doc/wiki/UserDatabase.Prefetch.txt>
#userdb {
#  driver = prefetch
#}

userdb {
  driver = ldap
  args = /etc/dovecot/dovecot-ldap.conf.ext

  # Default fields can be used to specify defaults that LDAP may override
  default_fields = uid={{dovecot_ldap_uid}} gid={{dovecot_ldap_gid}} home={{dovecot_ldap_home}}/{{dovecot_ldap_mailbox_path}}
}

# If you don't have any user-specific settings, you can avoid the userdb LDAP
# lookup by using userdb static instead of userdb ldap, for example:
# <doc/wiki/UserDatabase.Static.txt>
#userdb {
  #driver = static
  #args = uid=vmail gid=vmail home=/var/vmail/%u
#}
{%   else %}
# DebOps variable dovecot_user_accounts={{ dovecot_user_accounts }}
{%   endif %}
{% else %}
# DebOps variable dovecot_user_accounts={{ dovecot_user_accounts|default([]) }}
{% endif %}
